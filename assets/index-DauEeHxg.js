import{r as a,b as $}from"./index-C8JDo9Ti.js";import{b as v}from"./index-BRVvmMrA.js";import{a as p}from"./index-D8et1EaS.js";function E(n,t){return a.useReducer((r,o)=>{const i=t[r][o];return i??r},n)}const M=n=>{const{present:t,children:r}=n,o=O(t),i=typeof r=="function"?r({present:o.isPresent}):a.Children.only(r),c=v(o.ref,i.ref);return typeof r=="function"||o.isPresent?a.cloneElement(i,{ref:c}):null};M.displayName="Presence";function O(n){const[t,r]=a.useState(),o=a.useRef({}),i=a.useRef(n),c=a.useRef("none"),l=n?"mounted":"unmounted",[N,s]=E(l,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return a.useEffect(()=>{const e=f(o.current);c.current=N==="mounted"?e:"none"},[N]),p(()=>{const e=o.current,u=i.current;if(u!==n){const A=c.current,d=f(e);n?s("MOUNT"):d==="none"||(e==null?void 0:e.display)==="none"?s("UNMOUNT"):s(u&&A!==d?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,s]),p(()=>{if(t){const e=m=>{const d=f(o.current).includes(m.animationName);m.target===t&&d&&$.flushSync(()=>s("ANIMATION_END"))},u=m=>{m.target===t&&(c.current=f(o.current))};return t.addEventListener("animationstart",u),t.addEventListener("animationcancel",e),t.addEventListener("animationend",e),()=>{t.removeEventListener("animationstart",u),t.removeEventListener("animationcancel",e),t.removeEventListener("animationend",e)}}else s("ANIMATION_END")},[t,s]),{isPresent:["mounted","unmountSuspended"].includes(N),ref:a.useCallback(e=>{e&&(o.current=getComputedStyle(e)),r(e)},[])}}function f(n){return(n==null?void 0:n.animationName)||"none"}export{M as $};
